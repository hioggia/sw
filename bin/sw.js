(function(a,b){var c=a[b]={name:"Superluminal World",version:"0.1",global:a,path:"script/",debug:!0,compiled:!1};c.log=function(){c.debug&&console.log.apply(console,Array.prototype.slice.call(arguments,0))};c.assert=function(){c.debug&&!1===arguments[0]&&console.error.apply(console,Array.prototype.slice.call(arguments,1))};var d=function(a){if("factory"in f[a]){var b=f[a].factory(c.require,f[a].exports,f[a]);b&&(f[a].exports=b);delete f[a].factory}return f[a].exports},e=function(a){if(!(a in f)){f[a]=
null;var b=document.createElement("script"),d=function(c){if("readystatechange"!=c.type||"loaded"==b.readyState||"complete"==b.readyState)b.removeEventListener("load",d,!1),b.removeEventListener("readystatechange",d,!1),b.removeEventListener("error",e,!1)},e=function(){b.removeEventListener("load",d,!1);b.removeEventListener("readystatechange",d,!1);b.removeEventListener("error",e,!1);throw"\u52a0\u8f09\u8173\u672c\u6642\u767c\u751f\u932f\u8aa4\uff1a "+a;};h++;b.addEventListener("load",d,!1);b.addEventListener("readystatechange",
d,!1);b.addEventListener("error",e,!1);b.src=c.path+a+".js";document.body.appendChild(b)}},f={},g={},h=0,i=[];c.define=function(a,b){if(!c.compiled&&!(a in f))throw"\u901a\u904erequire\u8acb\u6c42\u7684\u6587\u4ef6\u8207define\u4e2d\u5b9a\u7fa9\u7684\u8def\u5f91\u4e0d\u7b26\uff0c \u8acb\u6aa2\u67e5\uff1a "+a;f[a]={exports:{},factory:b};"function"==typeof b?c.compiled||b.toString().replace(/\brequire\b\s*\(\s*([\'\"])([\w\/\\-_]+)\1\s*\)/g,function(c,a,b){e(b);return c}):(f[a].exports=b,delete f[a].factory);
if(c.compiled||0==--h){for(a in g){var r=g[a],s=d(a);g[a]=null;delete g[a];r(s)}for(;0<i.length;)c.require(i.shift())}};c.require=function(c,a){if(f[c]){var b=d(c);if("function"==typeof a)a(b);else return b}else"function"==typeof a?g[c]=a:i.push(c),e(c)};var q=function(c){var a={};if(null==c)a=null;else if(c instanceof Array)for(var a=[],b=0,d=c.length;b<d;b++)"object"==typeof c[b]?a.push(q(c[b])):a.push(c[b]);else for(b in c)a[b]="object"==typeof c[b]?q(c[b]):c[b];return a};c.Class=function(){};
c.Class.derive=function(c){function a(){for(var c in e)this[c]="object"==typeof e[c]?q(e[c]):e[c];arguments.callee.caller!=f&&"function"==typeof this.init&&this.init.apply(this,Array.prototype.slice.call(arguments,0))}var b=this,d=new b,f=arguments.callee,e={},g;for(g in d)"function"==typeof d[g]?a.prototype[g]=d[g]:e[g]=d[g];for(g in c)"function"==typeof c[g]?a.prototype[g]=c[g]:e[g]=c[g];a.prototype.parent=function(c){return b.prototype[c].apply(this,Array.prototype.slice.call(arguments,1))};a.derive=
f;return a}})(window,"SW");"bind"in Function.prototype||(Function.prototype.bind=function(a){var b=this;return function(){b.apply(a,Array.prototype.slice.call(arguments,0))}});SW.compiled=!0;SW.define("modules/benchmark",function(){var a={storage:function(){return"localStorage"in window}};return{testAll:function(b){for(var c in a)b(c,a[c]())},test:function(b,c){for(var d=0,e=b.length;d<e;d++)b[d]in a&&c(b[d],a[b[d]]())}}});SW.define("modules/ease",function(){var a={linear:function(a){return a},easeIn:function(a){return Math.pow(a,2)},easeOut:function(a){return 1-Math.pow(a-1,2)},cubicIn:function(a){return Math.pow(a,3)},cubicOut:function(a){return Math.pow(a-1,3)+1},quartIn:function(a){return Math.pow(a,4)},quartOut:function(a){return Math.pow(a-1,4)+1},quintIn:function(a){return Math.pow(a,5)},quintOut:function(a){return Math.pow(a-1,5)+1}};return function(b,c){switch(b.toLowerCase().replace(/\s/g,"")){case "easein":return a.easeIn(c);
case "easeout":return a.easeOut(c);case "easeinout":return 0.5<c?a.easeOut(c):a.easeIn(c);case "cubicin":return a.cubicIn(c);case "cubicout":return a.cubicOut(c);case "cubicinout":return 0.5<c?a.cubicOut(c):a.cubicIn(c);case "quartin":return a.quartIn(c);case "quartout":return a.quartOut(c);case "quartinout":return 0.5<c?a.quartOut(c):a.quartIn(c);case "quintin":return a.quintIn(c);case "quintout":return a.quintOut(c);case "quintinout":return 0.5<c?a.quintOut(c):a.quintIn(c);default:return a.linear(c)}}});SW.define("modules/eventhost",function(){return SW.Class.derive({bindEvents:{},liveEvents:{},init:function(){},bind:function(a,b,c){var d=this.bindEvents[b];a.addEventListener(b,c,!1);d instanceof Array?d.push(a,c):this.bindEvents[b]=[a,c]},unbind:function(a,b,c){var d=this.bindEvents[b];if("function"==typeof c){if(a.removeEventListener(b,c,!1),d instanceof Array)for(var e=0,b=d.length;e<b;e+=2)if(d[e]==a&&d[e+1]==c){d.splice(e,2);break}}else if(d instanceof Array)for(e=d.length-2;0<=e;e-=2)d[e]==
a&&(a.removeEventListener(b,d[e+1],!1),d.splice(e,2))},live:function(){},die:function(){},trigger:function(a,b,c){var d=this.bindEvents[b],b=this.liveEvents[b];if(d instanceof Array)for(var e=0,f=d.length;e<f;e+=2)if(d[e]==a)d[e](c);if(b instanceof Array){e=0;for(f=b.length;e<f;e+=3);}},drop:function(){for(var a in this.bindEvents)for(var b=this.bindEvents[a],c=b.length-2;0<=c;c-=2)b[c].removeEventListener(eventType,b[c+1],!1),b.splice(c,2);for(a in this.liveEvents){b=this.liveEvents[a];for(c=b.length-
3;0<=c;c-=3)b[c].removeEventListener(eventType,b[c+2],!1),b.splice(c,3)}}})});SW.define("modules/imagecache",function(){return SW.Class.derive({attached:0,cached:0,callbacks:[],loading:{},animeIndex:{},caches:{},onload:null,onerror:null,init:function(){this.onload=this._onload.bind(this);this.onerror=this._onerror.bind(this)},attach:function(a){if(!(a in this.caches||a in this.loading)){SW.log("\u5c07\u5716\u50cf\u8f09\u5165\u5feb\u53d6: "+a);this.attached++;var b=this.loading[a]=new Image;this.animeIndex[a]=0;b.addEventListener("load",this.onload,!1);b.addEventListener("error",
this.onerror,!1);b.setAttribute("data-url",a);b.src=a}},erase:function(a){a in this.caches&&(SW.log("\u79fb\u9664\u5feb\u53d6: "+a),this.caches[a]=null,delete this.caches[a],this.cached--,this.attached--)},get:function(a){if(a in this.caches)return this.caches[a];SW.log("\u8acb\u6c42\u7684\u5716\u50cf\u4e0d\u5b58\u5728\u5feb\u53d6\u4e2d: "+a);return null},complete:function(a){if("function"==typeof a){for(var b=0,c=this.callbacks.length;b<c;b++)if(this.callbacks[b]==a)return;SW.log("\u5feb\u53d6\u56de\u8abf\u5df2\u8a2d\u7f6e");
this.callbacks.push(a)}},has:function(a){return a in this.caches},clear:function(){this.cached=this.attached=0;this.callbacks=[];for(var a in this.loading)this.loading[a].removeEventListener("load",this.onload,!1),this.loading[a].removeEventListener("error",this.onerror,!1),this.loading[a].removeAttribute("data-url"),this.loading[a]=null,delete this.loading[a],delete this.animeIndex[a];for(a in this.caches)this.caches[a]=null,delete this.caches[a];SW.log("\u5feb\u53d6\u5df2\u6e05\u96f6")},drawTo:function(a,
b){var c=Array.prototype.slice.call(arguments,2);if(this.has(b))a.drawImage.apply(a,[this.get(b)].concat(c));else{this.attach(b);var d;d=this.animeIndex[b]+=5;var e=0,f=0,g=0,h=0;switch(c.length){case 4:e=c[0];f=c[1];g=c[2];h=c[3];break;case 8:e=c[4];f=c[5];g=c[6];h=c[7];break;default:return}c=a.createLinearGradient(0,f,0,h+f);d=d%h/h;0!=d&&(c.addColorStop(0,"rgba(62,98,232,"+(1-d)+")"),c.addColorStop(d,"rgba(62,98,232,1)"));c.addColorStop(d,"rgba(62,98,232,0)");c.addColorStop(1,"rgba(62,98,232,"+
(1-d)+")");a.save();a.fillStyle=c;a.fillRect(e,f,g,h);a.restore()}},drop:function(){this.clear();this.onerror=this.onload=this.animeIndex=this.loading=this.caches=null},_onload:function(a){var a=a.target,b=a.getAttribute("data-url");a.removeAttribute("data-url");this.caches[b]=a;this.loading[b]=null;delete this.loading[b];delete this.animeIndex[b];a.removeEventListener("load",this.onload,!1);a.removeEventListener("error",this.onerror,!1);this.cached++;if(this.cached==this.attached&&0<this.callbacks.length){a=
0;for(b=this.callbacks.length;a<b;a++)this.callbacks.shift()()}},_onerror:function(a){var a=a.target,b=a.getAttribute("data-url");a.removeAttribute("data-url");this.loading[b]=null;delete this.loading[b];delete this.animeIndex[b];a.removeEventListener("load",this.onload,!1);a.removeEventListener("error",this.onerror,!1);this.attached--;throw"\u8f09\u5165\u5716\u50cf\u5931\u6557: "+b;}})});SW.define("modules/timeline",function(){return SW.Class.derive({id:void 0,startTime:0,lastStopTime:0,procs:[],isRunning:!1,init:function(){},addProc:function(a){"function"==typeof a&&this.procs.push(a);this.isRunning||this.start()},removeProc:function(a){for(var b=0,c=this.procs.length;b<c;b++)if(this.procs[b]==a){this.procs.splice(b,1);break}0==this.procs.length&&this.stop()},getTick:function(){var a=(new Date).getTime();return this.isRunning?a-this.startTime:this.lastStopTime-this.startTime},start:function(){this.id||
(this.startTime+=(new Date).getTime()-this.lastStopTime,this.lastStopTime=0,this.id=setInterval(this.process.bind(this),0),this.isRunning=!0)},stop:function(){clearInterval(this.id);this.id=void 0;this.lastStopTime=(new Date).getTime();this.isRunning=!1},process:function(){for(var a=(new Date).getTime()-this.startTime,b=0,c=this.procs.length;b<c;b++)this.procs[b](a)},drop:function(){this.stop();this.procs=[]}})});SW.define("game/background",function(){return SW.Class.derive({width:0,height:0,screenWidth:0,imgList:null,imgLength:0,cache:null,init:function(a,b,c,d,e){this.cache=e;this.screenWidth=a;this.width=c;this.height=d;this.imgList=b;this.imgLength=this.imgList.length},drawTo:function(a,b){for(var c=Math.floor(b/this.width),d=Math.ceil((b+this.screenWidth-c*this.width)/this.width),d=c+d;c<d;c++)this.cache.drawTo(a,this.imgList[c%this.imgLength],c*this.width-b,0,this.width,this.height)},drop:function(){for(var a=
0,b=this.imgLength;a<b;a++)this.cache.erase(this.imgList[a]);this.cache=null}})});SW.define("game/camera",function(){return SW.Class.derive({x:0,minX:0,maxX:Infinity,lockOnObject:null,lockOnMinScreenX:0,lockOnMaxScreenX:0,init:function(a,b,c){this.lockOnObject=a;this.lockOnMinScreenX=b;this.lockOnMaxScreenX=c},setMin:function(a){this.minX=a},setMax:function(a){this.maxX=a},update:function(){var a=this.lockOnObject.x-this.x;a>this.lockOnMaxScreenX?this.x=Math.min(this.maxX,this.lockOnObject.x-this.lockOnMaxScreenX):a<this.lockOnMinScreenX&&(this.x=Math.max(this.minX,this.lockOnObject.x-
this.lockOnMinScreenX))},drop:function(){this.lockOnObject=null}})});SW.define("game/commander",function(a){var b=a("modules/ease");return SW.Class.derive({cache:null,imgUrl:void 0,imgSize:0,shapes:null,target:null,leastScore:0,command:[],animeCommand:[],fever:0,maxFever:0,init:function(a,b){this.cache=b;this.imgUrl=a.imgUrl;this.imgSize=a.size;this.shapes=a.shapes;this.target=a.target;this.leastScore=a.leastScore;this.maxFever=a.maxFever;this.target.time*=1E3},addCommand:function(a){a.score>this.leastScore&&(this.animeCommand.push({shape:a.shape,lastTick:void 0,pos:this.command.length,
size:a.size,x:a.x,y:a.y}),this.command.push(a.shape),this.fever+=a.score/10,this.fever>this.maxFever&&(this.fever=this.maxFever))},getCommand:function(){return 4>this.command.length?null:this.command.splice(0,4)},getFever:function(){return this.fever},useFever:function(a){var b=0,b=Math.min(this.fever,a);this.fever-=b;return b},draw:function(a,d){for(var e=0,f=0,g=this.animeCommand.length;f<g;f++){var h=this.animeCommand[f],i=0,q=this.shapes[h.shape]*this.imgSize,j=this.target.x+h.pos*(this.target.size+
this.target.gap),l=this.target.y,r=this.target.size;void 0==h.lastTick?h.lastTick=d:i=(d-h.lastTick)/this.target.time;1>i?(r=b("cubicIn",i)*(this.target.size-h.size)+h.size,j=b("cubicIn",i)*(j-h.x)+h.x,l=b("cubicIn",i)*(l-h.y)+h.y):e++;this.cache.drawTo(a,this.imgUrl,q,0,this.imgSize,this.imgSize,j,l,r,r)}4<=e&&4500<=d-this.animeCommand[3].lastTick&&this.animeCommand.splice(0,4);a.save();a.strokeStyle="#000";a.strokeRect(10,90,300,40);a.fillStyle="#ddb708";a.fillRect(10,90,Math.round(300*(this.fever/
this.maxFever)),40);a.restore()},drop:function(){}})});SW.define("game/controller",function(a){var b=a("modules/eventhost"),c=(a="ontouchstart"in window)?"touchstart":"mousedown",d=a?"touchmove":"mousemove",e=a?"touchend":"mouseup";return SW.Class.derive({canvas:null,controller:null,isStarted:!1,customEvents:{start:[],drawing:[],end:[]},init:function(a){this.canvas=a;this.controller=new b;this.controller.bind(window,"touchstart",function(a){a.preventDefault()});this.controller.bind(this.canvas,c,this.startEvent.bind(this));this.controller.bind(this.canvas,
e,this.endEvent.bind(this));this.controller.bind(this.canvas,d,this.moveEvent.bind(this))},addControl:function(a,c){a in this.customEvents&&this.customEvents[a].push(c)},startEvent:function(a){this.isStarted=!0;a.touches?(x=a.touches[0].pageX,y=a.touches[0].pageY):(x=a.pageX,y=a.pageY);for(var a=0,c=this.customEvents.start.length;a<c;a++)this.customEvents.start[a].call(null,x,y)},endEvent:function(a){var c=0,b=0;this.isStarted=!1;a.changedTouches?(c=a.changedTouches[0].pageX,b=a.changedTouches[0].pageY):
(c=a.pageX,b=a.pageY);for(var a=0,d=this.customEvents.end.length;a<d;a++)this.customEvents.end[a].call(null,c,b)},moveEvent:function(a){var c=0,b=0;if(this.isStarted){a.changedTouches?(c=a.changedTouches[0].pageX,b=a.changedTouches[0].pageY):(c=a.pageX,b=a.pageY);for(var a=0,d=this.customEvents.drawing.length;a<d;a++)this.customEvents.drawing[a].call(null,c,b)}},drop:function(){this.controller.drop();this.canvas=this.controller=null;for(var a in this.customEvents)this.customEvents[a]=[]}})});SW.define("game/damage",function(a){var b=a("modules/ease");return SW.Class.derive({damage:0,yOffset:0,alpha:1,lastTick:0,targetTime:2E3,targetY:100,end:!1,init:function(a){this.damage=a},update:function(a){0==this.lastTick&&(this.lastTick=a);a-this.lastTick<=this.targetTime?(a=b("easeOut",(a-this.lastTick)/this.targetTime),this.yOffset=a*this.targetY,this.alpha=1-a):this.end=!0},drawTo:function(a,b,e){a.save();a.textAlign="center";a.textBaseline="middle";a.fillStyle="rgb(255,0,0)";a.font="20px sans-serif";
a.globalAlpha=this.alpha;a.fillText("-"+this.damage,b,e-this.yOffset);a.restore()},drop:function(){}})});SW.define("game/evaluation",function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=null,d=0,e=0,f=0,g="",h=0,i=0,q={k:function(){b.save();b.lineWidth=2*d;b.beginPath();b.moveTo(d,d);b.lineTo(a.width-d,d);b.lineTo(a.width-d,a.height-d);b.lineTo(d,a.height-d);b.stroke();b.restore()},o:function(){b.save();b.lineWidth=2*d;b.beginPath();b.arc(a.width/2,a.height/2,(a.width+a.height)/4-d,0,2*Math.PI,!1);b.stroke();b.restore()},t:function(){b.save();b.lineWidth=2*d;b.beginPath();b.moveTo(d,
d);b.lineTo(d,a.height-d);b.moveTo(d,a.height/2);b.lineTo(a.width-d,a.height/2);b.stroke();b.restore()},v:function(){b.save();b.lineWidth=2*d;b.beginPath();b.moveTo(d,d);b.lineTo(a.width/2,a.height-d);b.lineTo(a.width-d,d);b.stroke();b.restore()}};return function(j,l){var r=0,s=0,m=0;c=j;d=l;f=e=Infinity;g="";for(var m=i=h=0,n=c.length;m<n;m+=2)"-"==c[m]&&m++,r=Math.max(c[m],r),s=Math.max(c[m+1],s),e=Math.min(c[m],e),f=Math.min(c[m+1],f);m=Math.max(r-e,s-f);a.width=m+2*d;a.height=m+2*d;b.lineCap=
"round";for(var u in q){var r=u,n=s=0,k=null;b.clearRect(0,0,a.width,a.height);q[r]();for(var k=b.getImageData(0,0,a.width,a.height),p=0,v=k.data.length;p<v;p+=4)0!=k.data[p+3]&&(s+=1);n=s;b.globalCompositeOperation="destination-out";b.save();b.lineWidth=3*d;b.beginPath();k=0;for(p=c.length;k<p;k+=2)"-"==c[k]?(k++,b.moveTo(c[k]-e+d,c[k+1]-f+d)):b.lineTo(c[k]-e+d,c[k+1]-f+d);b.stroke();b.restore();k=b.getImageData(0,0,a.width,a.height);p=0;for(v=k.data.length;p<v;p+=4)0!=k.data[p+3]&&(n-=1);b.globalCompositeOperation=
"source-over";n>h&&(h=n,i=Math.floor(1E3*(n/s))/10,g=r)}return{shape:g,score:i,x:e,y:f,size:m}}});SW.define("game/main",function(a){function b(a){var c=p.getCommand();if(null!=c)switch(c=c.join(""),c){case "oook":n.sendCommand("run");break;case "okok":n.sendCommand("back");break;case "kkok":n.sendCommand("fire");break;default:n.sendCommand("idle")}u.update(a);k.update(a);0>=n.hp&&(alert("game over"),s.removeProc(b));if(1<(a-z)/v){j.clearRect(0,0,l.width,l.height);u.drawBackground(j,k.x);u.drawUnits(j,k.x,l.width);p.draw(j,a);j.save();j.strokeStyle="rgba(255,255,255,0.5)";j.lineWidth=2*l.paintWidth;
j.lineCap="round";j.beginPath();for(var c=0,d=t.length;c<d;c+=2)"-"==t[c]?(c++,j.moveTo(t[c],t[c+1])):j.lineTo(t[c],t[c+1]);j.stroke();j.restore();w++;Math.floor(a/1E3)>A&&(B=w,w=0,A++);j.fillText("fps: "+B,800,80)}z=a-a%v}var c=a("modules/timeline"),d=a("modules/imagecache"),e=a("game/controller"),f=a("game/camera"),g=a("game/stage"),h=a("game/commander"),i=a("game/model/player"),q=document.querySelector("canvas"),j=q.getContext("2d"),l=a("game/settings"),r=a("game/evaluation"),s=new c,m=new d,n=
c=null,u=null,k=null,p=null,v=1E3/l.fps,z=0,t=[],C=0,w=0,B=0,A=0;q.width=l.width;q.height=l.height;j.font=l.font;c=new e(q);n=new i(30,l.player,m);k=new f(n,30,300);p=new h(l.evaluation,m);a("game/stage/1",function(a){u=new g(a,l,m);u.addPlayerUnit(n);window.stage=u;s.addProc(b)});c.addControl("start",function(a,c){clearTimeout(C);t.push("-",a,c)});c.addControl("drawing",function(a,c){t.push(a,c)});c.addControl("end",function(a,c){t.push(a,c);C=setTimeout(function(){var a=r(t,l.paintWidth);p.addCommand(a);
t=[]},300)});return 0});SW.define("game/model",function(a){var b=a("game/damage");return SW.Class.derive({x:0,y:0,width:0,height:0,imgUrl:void 0,sprites:null,frameTime:0,hp:0,maxHp:0,command:"idle",cache:null,lastTick:0,elapseTick:0,animeTick:0,damageList:[],init:function(a,b,e){this.x=a;this.y=b.y;this.width=b.width;this.height=b.height;this.imgUrl=b.imgUrl;this.sprites=b.sprites;this.frameTime=1E3*b.frameTime;this.cache=e;this.maxHp=this.hp=b.hp},sendCommand:function(a){this.command!=a&&(this.animeTick=this.elapseTick=
0);this.command=a},damage:function(a){this.damageList.push(new b(a));this.hp-=a},update:function(a){for(var b=this.damageList.length-1;0<=b;b--){var e=this.damageList[b];e.update(a);e.end&&(e.drop(),this.damageList.splice(b,1))}this.lastTick=a;0==this.animeTick&&(this.animeTick=a)},drawTo:function(a,b){var e=0,e=null,f=0,e=this.sprites[this.command],f=Math.floor((this.lastTick-this.animeTick)/this.frameTime)%e.length,e=e[f]*this.width;this.cache.drawTo(a,this.imgUrl,e,0,this.width,this.height,b,this.y,
this.width,this.height);a.save();a.strokeStyle="#000";a.strokeRect(b,this.y-10,100,10);a.fillStyle="#0f0";a.fillRect(b,this.y-10,Math.round(100*(this.hp/this.maxHp)),10);a.restore();e=0;for(f=this.damageList.length;e<f;e++)this.damageList[e].drawTo(a,b+this.width/2,this.y)},drop:function(){this.cache=null}})});SW.define("game/settings",{width:960,height:640,fps:30,font:"40px sans-serif",paintWidth:15,evaluation:{imgUrl:"image/evaluation.png",size:256,leastScore:60,maxFever:250,target:{x:15,y:140,size:64,gap:12,time:3},shapes:{k:0,o:1,t:2,v:3}},player:{y:400,width:286,height:180,imgUrl:"image/player.png",sprites:{idle:[0],run:[0],back:[0],fire:[0,1,0,1,0,0,0,0,0,0]},frameTime:0.05,speed:80,atk:100,hp:8E3,cd:0.5,range:180,walkLength:300},emeny1:{y:260,width:400,height:400,imgUrl:"image/emeny1.png",sprites:{idle:[3,
4,5,6,7,8],run:[3],back:[3],fire:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,1,2]},frameTime:0.05,speed:20,atk:20,hp:1E3,cd:1,range:100,vision:400},emeny2:{y:220,width:400,height:400,imgUrl:"image/emeny2.png",sprites:{idle:[3,4,5,6,7,8],run:[3],back:[3],fire:[0,1,2]},frameTime:0.05,speed:30,atk:50,hp:2E4,cd:1,range:200,vision:400}});SW.define("game/stage",function(a){var b=a("game/model/emeny"),c=a("game/background");return SW.Class.derive({playerUnits:[],emenyUnits:[],background:null,init:function(a,e,f){for(var g=0,h=a.waves[0].emenys.length;g<h;g++){var i=a.waves[0].emenys[g];this.emenyUnits.push(new b(i.x,e[i.name],f))}this.background=new c(e.width,a.backgrounds,a.backgroundWidth,e.height,f)},addPlayerUnit:function(a){this.playerUnits.push(a)},update:function(a){for(var b=this.emenyUnits.length-1;0<=b;b--){var c=this.emenyUnits[b];
0>=c.hp&&(c.drop(),this.emenyUnits.splice(b,1));for(var g=0,h=this.playerUnits.length;g<h;g++){var i=this.playerUnits[g];i.x>c.x?(c.lockOn=null,c.sendCommand("back")):i.x+c.range>=c.x?(c.lockOn=i,c.sendCommand("fire")):i.x+c.vision>=c.x&&(c.lockOn=null,c.sendCommand("run"))}c.update(a)}b=0;for(g=this.playerUnits.length;b<g;b++){for(var i=this.playerUnits[b],h=0,q=this.emenyUnits.length;h<q;h++)if(c=this.emenyUnits[h],c.x-i.range<=i.x){i.lockOn=c;break}i.update(a)}},drawUnits:function(a,b,c){for(var g=
0,h=this.emenyUnits.length;g<h;g++){var i=this.emenyUnits[g];i.x+i.width>b&&i.x<b+c&&i.drawTo(a,i.x-b)}g=0;for(h=this.playerUnits.length;g<h;g++)c=this.playerUnits[g],c.drawTo(a,c.x-b)},drawBackground:function(a,b){this.background.drawTo(a,b)},drop:function(){this.background.drop();this.background=null;for(var a=0,b=this.emenyUnits.length;a<b;a++)this.emenyUnits[a].drop()}})});SW.define("game/model/emeny",function(a){return a("game/model").derive({speed:0,atk:0,cd:0,range:0,vision:0,lockOn:null,init:function(a,c,d){this.parent("init",a,c,d);this.speed=Math.floor(1E3/c.speed);this.atk=c.atk;this.cd=1E3*c.cd;this.range=c.range;this.vision=c.vision},update:function(a){switch(this.command){case "run":this.elapseTick+=a-this.lastTick;this.elapseTick>=this.speed&&(this.x-=Math.floor(this.elapseTick/this.speed),this.elapseTick%=this.speed);break;case "back":this.elapseTick+=a-
this.lastTick;this.elapseTick>=this.speed&&(this.x+=Math.floor(this.elapseTick/this.speed),this.elapseTick%=this.speed);break;case "fire":this.elapseTick+=a-this.lastTick,this.elapseTick>=this.cd&&(this.lockOn&&this.lockOn.damage(this.atk),this.elapseTick%=this.cd)}this.parent("update",a)},drop:function(){this.parent("drop")}})});SW.define("game/model/player",function(a){return a("game/model").derive({speed:0,atk:0,cd:0,range:0,walked:0,walkLength:0,minX:0,maxX:Infinity,lockOn:null,init:function(a,c,d){this.parent("init",a,c,d);this.speed=Math.floor(1E3/c.speed);this.atk=c.atk;this.cd=1E3*c.cd;this.range=c.range;this.walkLength=c.walkLength},update:function(a){switch(this.command){case "idle":this.walked=0;break;case "run":this.elapseTick+=a-this.lastTick;if(this.elapseTick>=this.speed){var c=Math.floor(this.elapseTick/this.speed);
this.walked+=c;this.walked<=this.walkLength?(this.x+=c,this.elapseTick%=this.speed):this.sendCommand("idle")}break;case "back":this.elapseTick+=a-this.lastTick;this.elapseTick>=this.speed&&(c=Math.floor(this.elapseTick/this.speed),this.walked+=c,this.walked<=this.walkLength?(this.x-=Math.floor(this.elapseTick/this.speed),this.elapseTick%=this.speed):this.sendCommand("idle"));break;case "fire":this.elapseTick+=a-this.lastTick,this.elapseTick>=this.cd&&(this.lockOn&&0<this.lockOn.hp?(this.lockOn.damage(this.atk),
this.elapseTick%=this.cd):this.sendCommand("idle"))}this.x=Math.max(this.minX,Math.min(this.maxX-this.width,this.x));this.parent("update",a)},drop:function(){this.parent("drop")}})});SW.define("game/stage/1",{backgrounds:["image/bg_01.jpg","image/bg_02.jpg","image/bg_03.jpg","image/bg_04.jpg"],backgroundWidth:512,waves:[{end:1E4,emenys:[{name:"emeny1",x:1E3},{name:"emeny1",x:1100},{name:"emeny1",x:1200},{name:"emeny1",x:2E3},{name:"emeny1",x:2100},{name:"emeny1",x:2200},{name:"emeny1",x:2300},{name:"emeny1",x:2400},{name:"emeny1",x:2500},{name:"emeny1",x:2600},{name:"emeny1",x:3E3},{name:"emeny1",x:3100},{name:"emeny1",x:3200},{name:"emeny1",x:3300},{name:"emeny1",x:3400},{name:"emeny1",
x:3500},{name:"emeny1",x:3600},{name:"emeny1",x:4E3},{name:"emeny1",x:4050},{name:"emeny1",x:4100},{name:"emeny1",x:4150},{name:"emeny1",x:4200},{name:"emeny1",x:4250},{name:"emeny1",x:4300},{name:"emeny1",x:4350},{name:"emeny1",x:4400},{name:"emeny1",x:4450},{name:"emeny1",x:4500},{name:"emeny1",x:4550},{name:"emeny1",x:4600},{name:"emeny1",x:6E3},{name:"emeny1",x:6050},{name:"emeny1",x:6100},{name:"emeny1",x:6150},{name:"emeny1",x:6200},{name:"emeny1",x:6250},{name:"emeny1",x:6300},{name:"emeny1",
x:6350},{name:"emeny1",x:6400},{name:"emeny1",x:6450},{name:"emeny1",x:6500},{name:"emeny1",x:6550},{name:"emeny1",x:6600},{name:"emeny1",x:6602},{name:"emeny1",x:6604},{name:"emeny1",x:8E3},{name:"emeny1",x:8002},{name:"emeny1",x:8004},{name:"emeny1",x:8050},{name:"emeny1",x:8052},{name:"emeny1",x:8054},{name:"emeny1",x:8100},{name:"emeny1",x:8102},{name:"emeny1",x:8104},{name:"emeny1",x:8150},{name:"emeny1",x:8152},{name:"emeny1",x:8154},{name:"emeny1",x:8200},{name:"emeny1",x:8202},{name:"emeny1",
x:8204},{name:"emeny1",x:8250},{name:"emeny1",x:8252},{name:"emeny1",x:8254},{name:"emeny1",x:8300},{name:"emeny1",x:8302},{name:"emeny1",x:8304},{name:"emeny1",x:8350},{name:"emeny1",x:8352},{name:"emeny1",x:8354},{name:"emeny1",x:8400},{name:"emeny1",x:8402},{name:"emeny1",x:8404},{name:"emeny1",x:8450},{name:"emeny1",x:8452},{name:"emeny1",x:8454},{name:"emeny1",x:8500},{name:"emeny1",x:8502},{name:"emeny1",x:8504},{name:"emeny1",x:8506},{name:"emeny1",x:8508},{name:"emeny1",x:8510},{name:"emeny1",
x:8512},{name:"emeny1",x:8514},{name:"emeny1",x:8516},{name:"emeny1",x:8518},{name:"emeny1",x:8520},{name:"emeny2",x:9600}]}]});
